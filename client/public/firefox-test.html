<!DOCTYPE html>
<html>
<head>
    <title>Firefox Compatibility Test</title>
    <script src="/firefox-compatibility.js"></script>
</head>
<body>
    <h1>Firefox Compatibility Test</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function log(message, status = 'info') {
            const div = document.createElement('div');
            div.textContent = message;
            div.style.color = status === 'pass' ? 'green' : status === 'fail' ? 'red' : 'blue';
            results.appendChild(div);
            console.log(message);
        }
        
        // Test 1: Service Worker API blocking
        log('Testing Service Worker API blocking...');
        try {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/test-sw.js').then(() => {
                    log('❌ CRITICAL: Service Worker registration succeeded - this will cause crashes!', 'fail');
                }).catch(() => {
                    log('✅ PASS: Service Worker registration properly blocked', 'pass');
                });
            } else {
                log('✅ PASS: Service Worker API not available', 'pass');
            }
        } catch (e) {
            log('✅ PASS: Service Worker registration blocked with error: ' + e.message, 'pass');
        }
        
        // Test 2: Worker API blocking
        log('Testing Worker API blocking...');
        try {
            new Worker('data:text/javascript,console.log("test")');
            log('❌ FAIL: Worker creation should be blocked in Firefox', 'fail');
        } catch (e) {
            log('✅ PASS: Worker creation blocked: ' + e.message, 'pass');
        }
        
        // Test 3: Cache API blocking
        log('Testing Cache API blocking...');
        try {
            if (typeof caches !== 'undefined') {
                log('❌ FAIL: Caches API should be undefined in Firefox', 'fail');
            } else {
                log('✅ PASS: Caches API properly disabled', 'pass');
            }
        } catch (e) {
            log('✅ PASS: Caches API blocked: ' + e.message, 'pass');
        }
        
        // Test 4: Browser detection
        log('Testing browser detection...');
        const isFirefox = navigator.userAgent.indexOf('Firefox') !== -1;
        log(isFirefox ? '✅ Firefox detected - compatibility mode active' : 'ℹ️ Non-Firefox browser detected', isFirefox ? 'pass' : 'info');
        
        // Test 5: Memory management
        log('Testing memory management...');
        if (typeof window.gc === 'function') {
            log('✅ PASS: Garbage collection available', 'pass');
        } else {
            log('ℹ️ INFO: Garbage collection not available (normal)', 'info');
        }
        
        log('Firefox compatibility test completed. Check console for details.');
    </script>
</body>
</html>